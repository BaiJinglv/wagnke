<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>首页</title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/index.css" rel="stylesheet"/>
	<link href="icomoon/style.css" rel="stylesheet"/>
	<style>
		.clearfix {
			clear: both;
		}
		.message{
			width: 25px; height: 22px;
			margin-top: 10px;
		}
		.target{
			width: 95%;
			position: absolute;
			left: 2.5%;
			right: 2.5%;
			top: 163px;
			color: #000000;
			background-color: #FFFFFF;
			border-radius: 8px;
			box-shadow: 0 -8px 18px 2px #1B86E2;
		}
		ul,li{
			list-style: none;
		}
		.titlecontent{
			margin-top: 55px;
		}
		.titlecontentL{
			width: 50%;
			float: left;
			text-align: center;
		}
		.titlecontent li{
			float: left;
			width: 50%;
		}
		.titlecontentL li img{
			height: 24px;
		}
		.titlecontentR{
			width: 50%;
			float: right;
		}
		.titlecontentR p{
			float: left;
			margin-top: 10px;
			margin-left: 10px;
			font-size: 12px;
		}
		.titlecontent p{
			color: #000000;
		}
		.Notice{
			margin-top: 77px;
			padding: 10px;
			font-size: 12px;
			color: #000000;
			background-color: #DDDEDE;
		}
		.Notice-title{
			float: left;
		}
		.Notice span{
			float: left;
			margin-left: 15px;
		}
		.Notice img{
			float: right;
			width: 8px;
			margin-top: 3px;
		}
		.Background-picture{
			position: relative;
			text-align: center;
		}
		.Background-picture h4{
			position: absolute;
			top: 46%;
			left: 10%;
			right: 10%;
			font-size: 18px;
		}
		.function{
			width: 90%;
			position: absolute;
			margin-top: -35px;
			margin-left: 5%;
			border-radius: 8px;
			padding: 15px 0 15px 0;
			box-shadow: 0 0 15px 1px #D6D7D9;
			background-color: #fff;
		}
		.functionL{
			width: 50%;
			float: left;
		}
		.functionLc{
			width: 60%;
			color: #000000;
			margin: 0 auto;
			text-align: center;
		}
		.function img{
			height: 18px;
			float: left;
			margin-top: 10px;
		}
		.function p{
			float: left;
			color: #000000;
			margin-left: 15px;
			font-size: 15px;
			margin-top: 10px;
		}
		.functionR{
			width: 50%;
			float: right;
			border-left: 1px solid #F2F2F2;
		}
		.functionRc{
			width: 40%;
			color: #000000;
			margin: 0 auto;
			text-align: center;
		}
		
		.functional_selection{
			width: 90%;
			margin: 0 auto;
			margin-top: 37px;
			text-align: left;
		}
		.business_card{
			width: 48%;
			padding: 15px 10px;
			float: left;
			margin-top: 25px;
			border-radius: 7px;
			box-shadow: 0 0 15px 1px #D1D1D3;
			background-color: #fff;
			overflow: hidden;
		}
		.business_cardR{
			width: 48%;
			padding: 15px 10px;
			float: right;
			margin-top: 25px;
			border-radius: 7px;
			box-shadow: 0 0 15px 1px #D1D1D3;
			background-color: #fff;
			overflow: hidden;
		}
		.functional_selection img{
			width: 48px;
			float: left;
		}
		.functional_selection p{
			font-size: 15px;
			color: #000;
			margin-top: 5px;
		}
		.functional_selection span{
			font-size: 11px;
			display: block;
			margin-top: -8px;
		}
		#quick{
			width: 80%;
			margin: 0 auto;
			box-shadow: 0 0 15px 3px #D1D1D3;
			border-radius: 20px;
			background-color: #fff;
			display:none;
			margin-top: -133px;
			z-index: 9999;
		}
		#quick li{
			width: 25%;
			float: left;
			margin-top: 15px;
		}
		#quick li img{
			height: 22px;
		}
		#quick li p{
			font-size: 10px;
			color: #000000;
		}
		.jiandou{
			width: 19px;
			position: absolute;
			margin-left: -12px;
		}
		#back{
			position: fixed;
			top: 0;
			left: 0;
			display: none;
			width: 100%;
			height: 100%;
			opacity: 0.5;
		}
		#cover{
			position: fixed;
			z-index: 9999;
			top: 0;
			left: 0;
			display: none;
			width: 100%;
			height: 100%;
			opacity: 0.5;
			background: #484848 none repeat scroll 0% 0%;
		}
		#QR-code{
			width: 288px;
			height: 335px;
			background-color: #fff;
			display: none;
			z-index: 99999;
			position: fixed;
			top: 25%;
			left: 13%;
			border-radius: 8px;
			text-align: center;
		}
		.QR-tu{
			width: 217px;
			height: 217px;
			margin: 0 auto;
			padding-top: 30px;
		}
		.QR-tu img{
			width: 100%;
		}
		#QR-code span{
			display: block;
			font-size: 15px;
			margin-top: 50px;
			color: #000000;
			padding-bottom: 10px;
		}
		#QR-code a{
			font-size: 13px;
		}
	</style>
</head>
<body>
 	<div id="back" onclick="yc(),quick()"></div>
	<nav class="mui-bar mui-bar-tab" style="background-color: #FFFFFF;box-shadow: 0 0 5px 3px #DDDDDD;">
		<div>
			<a class="mui-tab-item mui-active">
				<span class="mui-icon icon-home-page" style="font-size: 18px;margin-top: 2px;"></span>
				<span class="mui-tab-label" style="margin-top: -2px;">首页</span>
			</a>
			<a class="mui-tab-item">
				<span class="mui-icon icon-chat" style="font-size: 18px;margin-top: 2px;"></span>
				<span class="mui-tab-label" style="margin-top: -2px;">聊天</span>
			</a>
			<a class="mui-tab-item"id="guan" onclick="ycit(),quick()">
				<span class="mui-icon icon-Quick" style="font-size: 18px;margin-top: 2px;"></span>
				<span class="mui-tab-label" style="margin-top: -2px;">快捷</span>
			</a>
			<a class="mui-tab-item">
				<span class="mui-icon icon-Selfmedia" style="font-size: 18px;margin-top: 2px;"></span>
				<span class="mui-tab-label" style="margin-top: -2px;">自媒体</span>
			</a>
			<a class="mui-tab-item" href="examples/my.html">
				<span class="mui-icon icon-my" style="font-size: 18px;margin-top: 2px;"></span>
				<span class="mui-tab-label" style="margin-top: -2px;">我的</span>
			</a>
		</div>
		<div id="quick">
			<li>
				<img src="image/entry-customer.png" >
				<p>录入客户</p>
			</li>
			<li>
				<img src="image/Targetmanagement.png" >
				<p>目标管理</p>
			</li>
			<li>
				<img src="image/fast_tracking.png" >
				<p>快速跟进</p>
			</li>
			<li>
				<img src="image/quick-collection.png" >
				<p>快速收款</p>
			</li>
			<div class="clearfix"></div>
			<img class="jiandou" src="image/quickxia.png" >
		</div>
	</nav>
</body>

<script src="js/util.js"></script>
<script type="text/javascript">
	mui.init({
		swipeBack: false
	});
	
	var navTitle;
	var mainWebview;
	var curBarItemWebview;
	
	var barItemWebviewArray = [];
	var barItemArray = ['html/home.html','html/category.html','html/wishList.html','html/cart.html','barItem/mine.html'];
	mui.plusReady(function(){
		//获取当前title和当前webview
		navTitle = document.querySelector('.mui-title');
		mainWebview = plus.webview.currentWebview();
		
		plus.navigator.setStatusBarBackground( "#41cea9" );
		
		//设置只支持竖屏幕显示
		plus.screen.lockOrientation("portrait-primary");
		//初始化与index有关的页面
		initIndexView();
		
		//判断是否已经登陆,若没有登陆将预加载登陆页面
		judgelogin();
		
		//预加载父子模版
		initTemplate();
	});
	
	
	//初始化
	function initIndexView(){
		//初始化所有bar页面
		initTabitemWebviews();
		//添加bar点击事件接受
		tapBaritem();
	}
	
	//初始化所有bar页面
	function initTabitemWebviews(){
		for (var i = 0; i < barItemArray.length; i++) {
			barItemWebviewArray[i] = mui.preload({
				id: barItemArray[i],
				url: barItemArray[i],
				styles: {
					top: 0,
					bottom: '51px',
					left: '0px',
					bounce: 'vertical',
					bounceBackground: '#f8f8f8'
				},
				waiting: {
					autoShow:false
				}
			});
			barItemWebviewArray[i].hide();
			mainWebview.append(barItemWebviewArray[i]);
		}
		barItemWebviewArray[0].show();
		curBarItemWebview = barItemWebviewArray[0];
	}
	
	
	//添加点击事件
	function tapBaritem(){
		mui('.mui-bar-tab').on('tap','.mui-tab-item',function(){
			var baritem = this;
			var baritemurl = baritem.getAttribute('href'); 
//				indexof()如果为false返回－1所以前面加上~
			if (!~curBarItemWebview.getURL().indexOf(baritemurl)) {
				for (var i = 0; i < barItemArray.length; i++) {
					if (barItemArray[i] == baritemurl) {
						//更改头部名字
						navTitle.innerText = baritem.children[baritem.children.length-1].innerText;
						//切换baritemwebview
						barItemWebviewArray[i].show();
						curBarItemWebview = barItemWebviewArray[i];
						break;
					}
				}
			}
		});
	}
	
	
	//预加载template
	function initTemplate(){
		var webview =  mui.preload({
			id:'template',
			url:'template.html',
			styles:{
				top: '-1000px',
			}
		});
		webview.show();
	};
	
	function judgelogin() {
//		localStorage.setItem('user', {name: 'xuelang'});
		localStorage.removeItem('user');
		//判断是否已经登录成功//localstorage在页面关闭的时候也同样存在，sessionstorage页面关闭数据不存在
		if (!localStorage.getItem('user')) {
			mui.preload({
				url:'html/login.html',
				id:'login',
				styles:{
					top: '0px',
					bottom: '0px'
				}
			});
			mui.openWindow({
			    url: 'html/login.html',
			    id: 'login',
			    show:{
			      	autoShow: true,
			      	aniShow: 'slide-in-bottom'
			    }
			});
		}
	}
	
	function ycit(){
            var zt = document.getElementById("back").style.display;
			var zt = document.getElementById("quick").style.display;
            if (zt == "block"){
                document.getElementById("back").style.display = "none";
            }else{
				document.getElementById("back").style.display = "block";
			}
			if (zt == "block"){
				document.getElementById("quick").style.display = "none";
			}else{
				document.getElementById("quick").style.display = "block";
			}   
        }
		
		function yc(){
			var zt = document.getElementById("back").style.display;
			var zt = document.getElementById("quick").style.display;
			if (zt == "block"){
				document.getElementById("back").style.display = "none";
			}else{
				document.getElementById("back").style.display = "block";
			}
			if (zt == "block"){
				document.getElementById("quick").style.display = "none";
			}else{
				document.getElementById("quick").style.display = "block";
			}   
		}
		
		function jiaoyi(){
			var jy = document.getElementById("cover").style.display;
			var jy = document.getElementById("QR-code").style.display;
			if (jy == "block"){
				document.getElementById("cover").style.display = "none";
			}else{
				document.getElementById("cover").style.display = "block";
			}
			if (jy == "block"){
				document.getElementById("QR-code").style.display = "none";
			}else{
				document.getElementById("QR-code").style.display = "block";
			}   
		}
		
		function guanb(){
			var jy = document.getElementById("cover").style.display;
			var jy = document.getElementById("QR-code").style.display;
			if (jy == "block"){
				document.getElementById("cover").style.display = "none";
			}else{
				document.getElementById("cover").style.display = "block";
			}
			if (jy == "block"){
				document.getElementById("QR-code").style.display = "none";
			}else{
				document.getElementById("QR-code").style.display = "block";
			}   
		}
</script>
</html>